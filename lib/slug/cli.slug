var {*} = import(
	"slug.std",
)

@export
var option = fn(...args) {
	if ( len(args) == 0 ) {
		nil
	} else {
		var t = args[-1] /> type
		args /> find(fn(v) { v != nil }) /> convertValue(t)
	}
}

@testWith(
	[nil, NIL_TYPE], nil,
	[nil, BOOLEAN_TYPE], false,
	[false, BOOLEAN_TYPE], false,
	[true, BOOLEAN_TYPE], true,
	[nil, NUMBER_TYPE], nil,
	["123", NUMBER_TYPE], 123,
	[nil, STRING_TYPE], nil,
	["123", STRING_TYPE], "123"
)
var convertValue = fn(newValue, targetType) match {
	[nv, tt] if type(nv) == tt => nv
	[nv, ^NIL_TYPE]     => nil
	[nv, ^BOOLEAN_TYPE] => toBoolean(nv)
	[nv, ^NUMBER_TYPE]  => toNumber(nv)
	[nv, ^STRING_TYPE]  => toString(nv)
	[nv, tt] => throw {type: "error", msg:"Cannot convert '{{nv}}' to type {{tt}}"}
}
