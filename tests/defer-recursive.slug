var {*} = import(
	"slug.std",
	"slug.test"
)

var rfc1 = 5

var rf1 = fn(a) {
	match a {
		0 => a
		v => {
			defer {
				rfc1 = rfc1 - 1
				// println("<<< rf1 defer ", a, rfc1)
			}
			// println("    rf1 before", a, rfc1)
			rfc1 /> assertEqual(a)
			recur( a - 1 )
		}
	}
}

rf1(rfc1) /> assertEqual(0)



var rfc2 = 5

var rf2 = fn(a) {
	if ( a <= 0 ) {
		a
	} else {
		defer {
			rfc2 = rfc2 - 1
			// println("<<< rf2 defer ", a, rfc2)
		}
		// println("    rf2 before", a, rfc2)
		rfc2 /> assertEqual(a)
		recur( a - 1 )
	}
}


rf2(rfc2) /> assertEqual(0)



var rfc3 = 5

var fn_level_test_defer_block_runs_once_on_scope_exit = fn(a) {
	defer {
		rfc3 = rfc3 - 1
		// println("<<< fn_level_test_defer_block_runs_once_on_scope_exit defer ", a, rfc3)
	}
	// println("    fn_level_test_defer_block_runs_once_on_scope_exit before", a, rfc3)
	rfc3 /> assertEqual(5)
	if(a > 0) {
		recur(a - 1)
	} else {
		a
	}
}

fn_level_test_defer_block_runs_once_on_scope_exit(rfc3) /> assertEqual(0)
rfc3 /> assertEqual(4)
